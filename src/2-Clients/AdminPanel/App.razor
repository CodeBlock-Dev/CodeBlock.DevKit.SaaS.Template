@using CodeBlock.DevKit.Clients.AdminPanel.Pages.Shared
@using CodeBlock.DevKit.Infrastructure.Services
@using CodeBlock.DevKit.Web.Blazor.Server
@using System.Reflection
@inject ModuleRegistry ModuleRegistry
@inherits AppBase

<CascadingBlazoredModal HideCloseButton="false" ContentScrollable="true" DisableBackgroundCancel="true">
    <CascadingAuthenticationState>
        <Router AppAssembly="@typeof(Program).Assembly" AdditionalAssemblies="@ModuleRegistry.GetUIModuleAssemblies()">
            <Found Context="routeData">
                <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                    <Authorizing>
                        <LayoutView Layout="@typeof(SimpleLayout)">
                            <Error ShowIndexLink=false Title="@BlazorServerLocalizer[BlazorServerResource.Error_Authorization_Title]" Message="@BlazorServerLocalizer[BlazorServerResource.Error_Authorization_Message]" />
                        </LayoutView>
                    </Authorizing>
                    <NotAuthorized>
                        <LayoutView Layout="@typeof(SimpleLayout)">
                            <RedirectToLogin />
                        </LayoutView>
                    </NotAuthorized>
                </AuthorizeRouteView>
            </Found>
            <NotFound>
                <LayoutView Layout="@typeof(SimpleLayout)">
                    <Error Title="@BlazorServerLocalizer[BlazorServerResource.Error_NotFound_Title]" Message="@BlazorServerLocalizer[BlazorServerResource.Error_NotFound_Message]" />
                </LayoutView>
            </NotFound>
        </Router>
    </CascadingAuthenticationState>
</CascadingBlazoredModal>
