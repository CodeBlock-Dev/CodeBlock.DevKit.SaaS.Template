@using CanBeYours.AdminPanel.Helpers
@using CanBeYours.Core.Domain.DemoThings

<EditForm Model="Input" OnValidSubmit="HandleUpdateDemoThing">
    <DataAnnotationsValidator />

    <div class="form-group p-2">
        <label class="f-sm text-secondary">
            @SharedLocalizer[SharedResource.DemoThing_Name]:
        </label>
        <InputText @bind-Value="Input.Name" class="form-control f-sm"></InputText>
        <ValidationMessage For="()=>Input.Name" class="text-danger f-sm"></ValidationMessage>
    </div>

    <div class="form-group p-2">
        <label class="f-sm text-secondary">
            @SharedLocalizer[SharedResource.DemoThing_Type]:
        </label>
        <InputSelect @bind-Value="Input.Type" class="form-control f-sm">
            @foreach (var type in Enum.GetValues<DemoThingType>())
            {
                <option value="@type">@type.GetEnumDisplayName()</option>
            }
        </InputSelect>
        <ValidationMessage For="() => Input.Type" class="text-danger f-sm"></ValidationMessage>
    </div>

    <div class="form-group p-2">
        <label class="f-sm text-secondary">
            @SharedLocalizer[SharedResource.DemoThing_Description]:
        </label>
        <InputTextArea @bind-Value="Input.Description" class="form-control f-sm" rows="3"></InputTextArea>
        <ValidationMessage For="()=>Input.Description" class="text-danger f-sm"></ValidationMessage>
    </div>

    <div class="form-group p-2">
        <button type="submit" class="btn f-sm btn-primary mr-1">
            @CoreLocalizer[CoreResource.Update]
        </button>
    </div>
</EditForm>

@code {
    [Parameter]
    public string DemoThingId { get; set; }

    protected UpdateDemoThingDto Input = new();

    [CascadingParameter]
    protected BlazoredModalInstance ModalInstance { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await GetDemoThing();
    }

    protected virtual async Task GetDemoThing()
    {
        var result = await DemoThingService.GetDemoThing(DemoThingId);
        if (!result.IsSuccess)
        {
            result.ShowErrorToast(ToastService);
            return;
        }

        Input = new UpdateDemoThingDto
        {
            Name = result.Value.Name,
            Type = result.Value.Type,
            Description = result.Value.Description
        };
    }

    protected virtual async Task HandleUpdateDemoThing()
    {
        var result = await DemoThingService.UpdateDemoThing(DemoThingId, Input);
        result.ShowToast(ToastService).PublishMessage(MessageService, Constants.DEMO_THING_UPDATED).CloseModal(ModalInstance);
    }
} 